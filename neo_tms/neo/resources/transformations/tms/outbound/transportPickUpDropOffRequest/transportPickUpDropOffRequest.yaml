---
- sourceModel: transportPickUpDropOffRequest
  targetModel: transportPickUpDropOffRequest
  modelMapping:
    headerMapping:
      segmentListMapping:
        - targetSegment: headerSegment
          fieldMapping:
          - targetField: receivers
            operations:
              - function:
                  functionName: generate_dynamic_receivers
                  functionArguments: [property: 'bydm.receivers.prefix', field: CISDocument.Dock.DockShippingLocationID ]
    payloadMapping:
      segmentMapping:
        - targetSegment: header
          fieldMapping:
            - targetField: sender
              default: "TMS.GLOBAL"
            - targetField: receiver
              operations:
                - function:
                    functionName: generate_dynamic_receivers
                    fields: [property: 'bydm.receivers.prefix', field: CISDocument.Dock.DockShippingLocationID ]
            - targetField: messageId
              operations:
                - function:
                    functionName: generate_uuid
                    fields: []
            - targetField: type
              default: "transportPickUpDropOffRequest"
            - targetField: creationDateAndTime
              operations:
                - function:
                    functionName: get_current_timestamp_iso8601
                    fields: []
            - targetField: messageVersion
              default: "BYDM 2021.9.0"
      segmentListMapping:
        - targetSegment: transportPickUpDropOffRequest
          fieldMapping:
            - targetField: creationDateTime
              operations:
                - function:
                    functionName: get_current_timestamp_iso8601
                    fields: []
            - targetField: documentStatusCode
              default: "ORIGINAL"
            - targetField: documentActionCode
              operations:
                - function:
                    functionName: getCodemap
                    functionArguments: [constant: "tms_event_to_documentactioncode", field: CISDocument.EventName]
            - targetField: dockType
              sourceField: dockTypeEnumVal
            - targetField: transportAppointmentType
              operations:
                - function:
                    functionName: getCodemap
                    functionArguments: [constant: "tms_stoptypeenumval", field: dockTypeEnumVal]
            - targetField: transportPickUpDropOffRequestId
              sourceField: CISDocument.DockCommitmentID
            - targetField: transportAppointmentTypeCode
              sourceField: ext_dock_stoptypeenumvalcode
          segmentMapping:
            - targetSegment: plannedPickUp
              segmentMapping:
                - targetSegment: logisticLocation
                  fieldMapping:
                    - targetField: additionalLocationId
                      sourceField: ext_pickup_additionalLocationId
                    - targetField: sublocationId
                      sourceField: ext_pickup_sublocationId
                  segmentMapping:
                    - targetSegment: locationSpecificInstructions
                      fieldMapping:
                        - targetField: value
                          operations:
                            - function:
                                functionName: getCodemap
                                functionArguments: [constant: "locationSpecificInstructions", field: ext_pickup_locationSpecificInstructions_value]
                        - targetField: languageCode
                          sourceField: ext_pickup_language
                - targetSegment: logisticEventPeriod 
                  condition:
                    - function:
                        functionName: not_blank
                        fields: ext_pickup_additionalLocationId
                  fieldMapping:
                    - targetField: beginDate
                      sourceField: ext_pickup_beginDate
                    - targetField: beginTime
                      operations:
                        - customFunction:
                            functionName: getTimeComponentForTPDR
                            fields: [
                                field: ext_pickup_beginTime,
                                field: ext_timeZoneOffset,
                                property: "default_date_time_format.timezone",
                              ]
                    - targetField: endDate
                      sourceField: ext_pickup_endDate
                    - targetField: endTime
                      operations:
                        - customFunction:
                            functionName: getTimeComponentForTPDR
                            fields: [
                                field: ext_pickup_endTime,
                                field: ext_timeZoneOffset,
                                property: "default_date_time_format.timezone",
                          ]
            - targetSegment: plannedDropOff
              segmentMapping:
                - targetSegment: logisticLocation
                  fieldMapping:
                    - targetField: additionalLocationId
                      sourceField: ext_dropoff_additionalLocationId
                    - targetField: sublocationId
                      sourceField: ext_dropoff_sublocationId
                  segmentMapping:
                    - targetSegment: locationSpecificInstructions
                      fieldMapping:
                        - targetField: value
                          operations:
                            - function:
                                functionName: getCodemap
                                functionArguments: [constant: "locationSpecificInstructions", field: ext_pickup_locationSpecificInstructions_value]
                        - targetField: languageCode
                          sourceField: ext_dropoff_language
                - targetSegment: logisticEventPeriod 
                  condition:
                    - function:
                        functionName: not_blank
                        fields: ext_dropoff_additionalLocationId
                  fieldMapping:
                    - targetField: beginDate
                      sourceField: ext_dropoff_beginDate
                    - targetField: beginTime
                      operations:
                        - customFunction:
                            functionName: getTimeComponentForTPDR
                            fields: [
                                field: ext_dropoff_beginTime,
                                field: ext_timeZoneOffset,
                                property: "default_date_time_format.timezone",
                              ]
                    - targetField: endDate
                      sourceField: ext_dropoff_endDate
                    - targetField: endTime
                      operations:
                        - customFunction:
                            functionName: getTimeComponentForTPDR
                            fields: [
                                field: ext_dropoff_endTime,
                                field: ext_timeZoneOffset,
                                property: "default_date_time_format.timezone",
                              ]
            - targetSegment: transportMeans
              fieldMapping:
                - targetField: transportMeansType
                  default: "31"
            - targetSegment: transportEquipment
              condition:
                function:
                  functionName: not_blank
                  fields: ext_transportEquipment_value
              fieldMapping:
                - targetField: assetId
                  default: ""
              segmentMapping:
                - targetSegment: transportEquipmentTypeCode
                  fieldMapping:
                    - targetField: value
                      sourceField: ext_transportEquipment_value
            - targetSegment: transportInstruction
              fieldMapping:
                - targetField: entityId
                  sourceField: CISDocument.SystemLoadID
            - targetSegment: slotProvider
              fieldMapping:
                - targetField: primaryId
                  sourceField: CISDocument.Dock.DockShippingLocationID
            - targetSegment: slotRequestor
              fieldMapping:
                - targetField: primaryId
                  sourceField: CISDocument.Carrier.CarrierCode
            - targetSegment: carrier
              fieldMapping:
                - targetField: primaryId
                  sourceField: CISDocument.Carrier.CarrierCode
                  default: ''
